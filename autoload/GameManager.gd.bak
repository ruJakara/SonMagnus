# autoload/GameManager.gd
# Глобальный менеджер игры. Отвечает за смену сцен, глобальные сигналы и общее состояние игры.
# Подключается как Autoload с именем "GameManager".

extends Node

## Сигналы
signal scene_changed(new_scene_path: String)
signal game_paused(is_paused: bool)

## @brief Инициализация класса GameManager.
func _ready() -> void:
	print("[GameManager] Загружен.")
	_check_managers()

## Проверка, что все нужные менеджеры подключены
func _check_managers() -> void:
	var required_managers = [
		"ItemManager",
		"CombatManager",
		"EffectManager",
		"SaveManager"
	]

	@warning_ignore("shadowed_variable_base_class")
	for name in required_managers:
		var node = get_node_or_null("/root/" + name)
		if node:
			print("[GameManager] ✔ %s найден." % name)
		else:
			push_warning("[GameManager] ⚠ %s не найден!" % name)

## Пауза / Возобновление игры
func set_pause(pause: bool) -> void:
	get_tree().paused = pause
	game_paused.emit(pause)
	print("Игра %s." % ("поставлена на паузу" if pause else "возобновлена"))

## Смена сцены
func change_scene_to_file(path: String) -> void:
	print("GameManager: Запрос на смену сцены на: %s" % path)
	var error = get_tree().change_scene_to_file(path)
	if error != OK:
		push_error("GameManager: Ошибка при смене сцены: %s" % error)
		return
	scene_changed.emit(path)

## Автосохранение (заглушка)

func get_autosave_data() -> Dictionary:
	@warning_ignore("incompatible_ternary")
	return {
		"player": {
			"position": Vector2.ZERO, # TODO: заменить на Player.position
			"hp": 100,                # TODO: заменить на Player.health
			"exp": 0                  # TODO: заменить на Player.exp
		},
		
		"world": {
			"scene":( get_tree().current_scene.name if get_tree().current_scene else "Unknown")
		}
	}
*** End Patch ***!

